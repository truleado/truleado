<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Product Creation</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        button { padding: 15px 30px; font-size: 16px; cursor: pointer; margin: 10px; border-radius: 8px; border: none; color: white; }
        #createButton { background-color: #4CAF50; }
        #checkButton { background-color: #008CBA; }
        .message { margin-top: 20px; font-size: 1.1em; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Test Product Creation & Lead Discovery</h1>
    <p>This will create a product and trigger lead discovery. Check the terminal for detailed logs.</p>
    
    <button id="createButton">Create Product & Discover Leads</button>
    <button id="checkButton">Check Database</button>
    
    <div id="results">
        Click "Create Product" to start...
    </div>

    <script>
        document.getElementById('createButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info">Creating product and discovering leads... Check terminal for detailed logs.</div>';
            
            try {
                const productData = {
                    name: 'Test CRM Product',
                    website: 'https://www.testcrm.com',
                    description: 'A CRM solution for small businesses',
                    features: ['Lead Management', 'Contact Tracking', 'Sales Pipeline'],
                    benefits: ['Increase sales', 'Save time', 'Better organization'],
                    painPoints: ['Lost leads', 'Poor follow-up', 'Manual processes'],
                    idealCustomerProfile: 'Small businesses, startups, entrepreneurs'
                };

                console.log('Sending product data:', productData);

                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response data:', result);
                
                if (result.success) {
                    resultsDiv.innerHTML = `
                        <div class="success">✅ Product created successfully!</div>
                        <p><strong>Product:</strong> ${result.product.name}</p>
                        <p><strong>Product ID:</strong> ${result.product.id}</p>
                        <p><strong>Message:</strong> ${result.message}</p>
                        <p><strong>Check the terminal for detailed lead discovery logs!</strong></p>
                        <p>Wait 30-60 seconds, then click "Check Database" to see if leads were saved.</p>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="error">❌ Error: ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('checkButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info">Checking database...</div>';
            
            try {
                const response = await fetch('/api/debug/check-leads');
                const data = await response.json();
                
                if (data.success) {
                    resultsDiv.innerHTML = `
                        <div class="success">✅ Database check complete!</div>
                        <p><strong>Products:</strong> ${data.productsCount}</p>
                        <p><strong>Leads:</strong> ${data.leadsCount}</p>
                        ${data.products.length > 0 ? `<p><strong>Products:</strong> ${data.products.map(p => p.name).join(', ')}</p>` : ''}
                        ${data.leads.length > 0 ? `<p><strong>Leads:</strong> ${data.leads.map(l => l.title).join(', ')}</p>` : ''}
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="error">❌ Error: ${data.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
