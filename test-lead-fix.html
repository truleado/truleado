<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Lead Discovery Fix</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px; }
        #results { margin-top: 20px; border: 1px solid #ccc; padding: 15px; background-color: #f9f9f9; }
        .lead-item { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
        .lead-item:last-child { border-bottom: none; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Test Lead Discovery Fix</h1>
    <p>This page tests if the lead discovery fixes are working properly.</p>
    
    <button id="testButton">Test Lead Discovery</button>
    <button id="checkLeadsButton">Check Existing Leads</button>
    
    <div id="results">
        Click a button to test...
    </div>

    <script>
        document.getElementById('testButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Testing lead discovery... Please wait.';
            
            try {
                // Test creating a simple product to trigger lead discovery
                const productData = {
                    name: 'Test CRM Tool',
                    website: 'https://example.com/test-crm',
                    description: 'A simple CRM tool for small businesses',
                    features: ['contact management', 'lead tracking', 'email automation'],
                    benefits: ['save time', 'increase sales', 'better organization'],
                    painPoints: ['disorganized contacts', 'lost leads', 'manual processes'],
                    idealCustomerProfile: 'small business owners, sales teams'
                };
                
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultsDiv.innerHTML = `
                        <div class="success">‚úÖ Product created successfully!</div>
                        <p>Product: ${result.product.name}</p>
                        <p>Message: ${result.message}</p>
                        <p>Lead discovery should be running in the background. Check the terminal logs for progress.</p>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('checkLeadsButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Checking for leads...';
            
            try {
                const response = await fetch('/api/leads');
                const result = await response.json();
                
                if (result.leads && result.leads.length > 0) {
                    let html = `<div class="success">üéâ Found ${result.leads.length} leads!</div>`;
                    result.leads.slice(0, 5).forEach((lead, index) => {
                        html += `
                            <div class="lead-item">
                                <h3>${index + 1}. ${lead.title}</h3>
                                <p><strong>Subreddit:</strong> r/${lead.subreddit}</p>
                                <p><strong>Score:</strong> ${lead.score}</p>
                                <p><strong>AI Score:</strong> ${lead.ai_analysis?.qualityScore || 'N/A'}</p>
                                <p><a href="${lead.reddit_post_url}" target="_blank">View on Reddit</a></p>
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="error">üòî No leads found yet.</div>
                        <p>This could mean:</p>
                        <ul>
                            <li>Lead discovery is still running (check terminal logs)</li>
                            <li>No relevant posts were found</li>
                            <li>Posts didn't meet the quality threshold</li>
                        </ul>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
