<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Lead Discovery Test</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px; }
        #results { margin-top: 20px; border: 1px solid #ccc; padding: 15px; background-color: #f9f9f9; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Manual Lead Discovery Test</h1>
    <p>This will manually trigger lead discovery for your existing products.</p>
    
    <button id="scanButton">Scan for Leads Now</button>
    <button id="populateButton">Populate Sample Leads</button>
    <button id="checkButton">Check Current Leads</button>
    
    <div id="results">
        Click "Scan for Leads Now" to manually trigger lead discovery...
    </div>

    <script>
        document.getElementById('scanButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Scanning for leads... This may take a few minutes.';
            
            try {
                const response = await fetch('/api/debug/scan-existing-products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultsDiv.innerHTML = `
                        <div class="success">‚úÖ Scan completed!</div>
                        <p><strong>Total leads found:</strong> ${result.totalLeads}</p>
                        ${result.sampleLeads && result.sampleLeads.length > 0 ? `
                            <h3>Sample leads:</h3>
                            ${result.sampleLeads.map((lead, index) => `
                                <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; background: white;">
                                    <strong>${index + 1}. ${lead.title}</strong><br>
                                    <small>r/${lead.subreddit} | Score: ${lead.score}/10</small><br>
                                    <a href="${lead.url}" target="_blank">View on Reddit</a>
                                </div>
                            `).join('')}
                        ` : '<p>No leads found this time.</p>'}
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('populateButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Creating sample leads...';
            
            try {
                const response = await fetch('/api/debug/populate-leads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultsDiv.innerHTML = `
                        <div class="success">‚úÖ Sample leads created!</div>
                        <p><strong>Created:</strong> ${result.leads.length} sample leads</p>
                        <h3>Sample leads:</h3>
                        ${result.leads.map((lead, index) => `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; background: white;">
                                <strong>${index + 1}. ${lead.title}</strong><br>
                                <small>r/${lead.subreddit} | AI Score: ${lead.score}/10</small><br>
                                <a href="${lead.url}" target="_blank">View on Reddit</a>
                            </div>
                        `).join('')}
                        <p><strong>Now go to <a href="/leads" target="_blank">/leads</a> to see them!</strong></p>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
        
        document.getElementById('checkButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Checking current leads...';
            
            try {
                const response = await fetch('/api/leads');
                const result = await response.json();
                
                if (result.leads && result.leads.length > 0) {
                    let html = `<div class="success">üéâ Found ${result.leads.length} existing leads!</div>`;
                    result.leads.slice(0, 10).forEach((lead, index) => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; background: white;">
                                <strong>${index + 1}. ${lead.title}</strong><br>
                                <small>r/${lead.subreddit} | Reddit Score: ${lead.score} | AI Score: ${lead.ai_analysis?.qualityScore || 'N/A'}</small><br>
                                <a href="${lead.reddit_post_url}" target="_blank">View on Reddit</a>
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="info">üìù No leads found in database yet.</div>
                        <p>Try clicking "Scan for Leads Now" to manually trigger lead discovery.</p>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
